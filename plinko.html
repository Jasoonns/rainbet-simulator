<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plinko - Rainbet</title>
    <style>
        :root { --bg-dark: #0f1219; --bg-panel: #1a202e; --primary: #00e701; }
        body { background: var(--bg-dark); color: white; font-family: 'Inter', sans-serif; display: flex; height: 100vh; margin: 0; overflow: hidden; }
        
        .sidebar-nav { width: 60px; background: #131721; border-right: 1px solid #232936; display: flex; flex-direction: column; align-items: center; padding-top: 20px; }
        .nav-icon { font-size: 24px; margin-bottom: 20px; text-decoration: none; opacity: 0.5; transition: 0.2s; }
        .nav-icon:hover { opacity: 1; transform: scale(1.1); }

        .game-layout { flex: 1; display: flex; }
        
        .controls-panel { width: 300px; background: #1a202e; padding: 25px; display: flex; flex-direction: column; gap: 20px; border-right: 1px solid #232936; }
        .input-label { color: #8892a3; font-size: 12px; font-weight: 700; margin-bottom: 5px; display: block; }
        .input-box { background: #0f1219; border: 1px solid #2f4553; border-radius: 4px; padding: 10px; display: flex; align-items: center; }
        input, select { background: transparent; border: none; color: white; width: 100%; font-weight: 600; outline: none; }
        select { background: #0f1219; cursor: pointer; }
        
        .btn-play { background: var(--primary); color: #000; border: none; padding: 15px; border-radius: 4px; font-weight: 900; cursor: pointer; font-size: 16px; margin-top: auto; box-shadow: 0 4px 0 #00b301; }
        .btn-play:active { transform: translateY(4px); box-shadow: none; }

        .stage { flex: 1; background: #0f1219; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        header { position: absolute; top: 0; right: 0; padding: 20px; }
        .balance { background: #1a202e; padding: 8px 16px; border-radius: 6px; font-weight: bold; border: 1px solid #2f4553; }
        
        canvas { background: radial-gradient(circle at center, #1a202e 0%, #0f1219 100%); border-radius: 12px; }
    </style>
</head>
<body>
    <div class="sidebar-nav">
        <a href="index.html" class="nav-icon">üè†</a>
        <a href="blackjack.html" class="nav-icon">‚ô†Ô∏è</a>
        <a href="mines.html" class="nav-icon">üíé</a>
        <a href="plinko.html" class="nav-icon" style="opacity:1; color:#00e701">üîª</a>
    </div>

    <div class="game-layout">
        <div class="controls-panel">
            <div>
                <label class="input-label">Bet Amount</label>
                <div class="input-box"><span>$</span><input type="number" id="bet" value="10"></div>
            </div>
            <div>
                <label class="input-label">Risk</label>
                <div class="input-box">
                    <select id="risk"><option value="low">Low</option><option value="medium" selected>Medium</option><option value="high">High</option></select>
                </div>
            </div>
            <div>
                <label class="input-label">Rows</label>
                <div class="input-box">
                    <select id="rows" disabled><option>16</option></select>
                </div>
            </div>
            <button class="btn-play" onclick="drop()">DROP BALL</button>
        </div>

        <div class="stage">
            <header><div class="balance" id="displayBalance">$0.00</div></header>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
        </div>
    </div>

    <script>
        // WALLET
        function getBal() { return parseFloat(localStorage.getItem('rainBalance')) || 0; }
        function setBal(n) { localStorage.setItem('rainBalance', n); document.getElementById('displayBalance').innerText = '$'+n.toFixed(2); }
        setBal(getBal());

        // PHYSICS & CANVAS
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const rows = 16;
        const pegSize = 3;
        const ballSize = 6;
        const startX = 400;
        const startY = 50;
        const gap = 30; // Spacing

        let balls = [];
        let pegs = [];
        
        // Setup Pegs
        for(let r=0; r<rows; r++) {
            for(let c=0; c<=r+2; c++) {
                let x = startX - ((r+2)*gap/2) + (c*gap);
                let y = startY + (r*gap);
                pegs.push({x, y});
            }
        }

        // Multipliers (Medium Risk 16 Rows approximation)
        // From outside in: High -> Low -> High
        const mults = [110, 41, 10, 5, 3, 1.5, 1, 0.5, 0.3, 0.5, 1, 1.5, 3, 5, 10, 41, 110];
        
        function getColor(val) {
            if(val >= 10) return '#ef4444'; // Red
            if(val >= 2) return '#f59e0b'; // Orange
            return '#eab308'; // Yellow
        }

        function drop() {
            let bet = parseFloat(document.getElementById('bet').value);
            if(bet > getBal() || bet <= 0) return alert('Invalid Balance');
            setBal(getBal() - bet);

            balls.push({
                x: startX + (Math.random()*2-1), // Tiny random offset to prevent stacking
                y: 20,
                vx: 0, 
                vy: 0,
                active: true,
                bet: bet
            });
        }

        function update() {
            ctx.clearRect(0,0,800,600);

            // Draw Pegs
            ctx.fillStyle = 'white';
            for(let p of pegs) {
                ctx.beginPath(); ctx.arc(p.x, p.y, pegSize, 0, 6.28); ctx.fill();
            }

            // Draw Buckets
            let bottomY = startY + (rows * gap) + 10;
            let count = rows + 1;
            for(let i=0; i<count; i++) {
                let x = startX - (count*gap/2) + (i*gap) + (gap/2);
                let m = mults[i] || 1;
                ctx.fillStyle = getColor(m);
                ctx.fillRect(x - 12, bottomY, 24, 30);
                
                ctx.fillStyle = '#000';
                ctx.font = '9px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(m+'x', x, bottomY + 18);
            }

            // Draw Balls
            for(let b of balls) {
                if(!b.active) continue;
                
                // Physics
                b.vy += 0.2; // Gravity
                b.vx *= 0.99; // Air resistance
                b.x += b.vx;
                b.y += b.vy;

                // Collisions
                for(let p of pegs) {
                    let dx = b.x - p.x;
                    let dy = b.y - p.y;
                    let dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < pegSize + ballSize) {
                        // Bounce
                        let angle = Math.atan2(dy, dx);
                        let force = 1.5; // Bounce strength
                        b.vx = Math.cos(angle) * force + (Math.random()-0.5); 
                        b.vy = Math.sin(angle) * force;
                        b.y += Math.sin(angle) * (pegSize+ballSize - dist);
                    }
                }

                ctx.fillStyle = '#00e701';
                ctx.beginPath(); ctx.arc(b.x, b.y, ballSize, 0, 6.28); ctx.fill();

                // Finish
                if(b.y > bottomY) {
                    b.active = false;
                    // Determine bucket
                    let distFromCenter = b.x - startX;
                    // Map x to bucket index
                    let totalW = count * gap;
                    let left = startX - totalW/2;
                    let idx = Math.floor((b.x - left) / gap);
                    if(idx < 0) idx = 0; if(idx >= count) idx = count-1;
                    
                    let multiplier = mults[idx] || 0.3;
                    let win = b.bet * multiplier;
                    setBal(getBal() + win);
                }
            }
            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>